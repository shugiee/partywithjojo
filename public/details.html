<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Jordyn and Jonathan's Wedding - Event Details</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta charset="UTF-8">
		<meta name="description" content="Details page for Jordyn Levy and Jonathan Olson's wedding in 2025.">
	</head>
	<body>
        <a href="./details">Event Details</a>
        <a href="./home">Home</a>
        <a href="./accommodations">Accommodations</a>
        <a href="./registry">Registry</a>
        <a href="./faq">FAQs</a>
        <a href="./rsvp">RSVP</a>
        <h1>Event Details</h1>
        <iframe
            width="600"
            height="450"
            style="border:0"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps/embed/v1/place?key=AIzaSyCDhUx8u5JVTNSRwPlDqJT3GMxoiUSkhaE&q=Beacon+Grand,San+Francisco+CA">
        </iframe>
        <input type="text" id="spotify-search"></input>
        <div id="spotify-search-results-container">
            <h2>Search results</h2>
            <div id="spotify-search-results" />
        <script>
            function getCookie(name) {
                return Object.fromEntries(
                    document.cookie
                    .split('; ')
                    .map(cookie => cookie.split('='))
                )[name] || null;
            };
            
            const searchSpotify = async (e) => {
                const spotifyToken = getCookie("spotify");
                console.log("Spotify token", spotifyToken);
                const text = e.target.value;
                console.log("Searching spotify with text", text);
                const params = new URLSearchParams();
                params.append("q", text);
                params.append("type", "track");
                try {
                    const spotifyResponse = await fetch(`https://api.spotify.com/v1/search?${params}`, {
                        method: "GET",
                        headers: {
                            "Authorization": `Bearer ${spotifyToken}`
                        },
                    });

                    if (!spotifyResponse.ok) {
                        throw new Error(`Response status: ${spotifyResponse.status}`);
                    }

                    const json = await spotifyResponse.json();
                    console.log("Spotify response", json);
                    const searchResultsElement = document.getElementById("spotify-search-results");
                    searchResultsElement.innerHTML = JSON.stringify(json.tracks.items.map(track => {
                        const { name, artists } = track;
                        return [name, artists.map(artist => artist.name)];
                    })
                    );
                } catch (error) {
                    console.error("JOnathan error", error.message);
                    return null;
                }
            };
            document.getElementById("spotify-search").addEventListener("change", searchSpotify);
        </script>
    </body>
</html>
